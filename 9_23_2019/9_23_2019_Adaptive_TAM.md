# Janus : Adaptive TAM (9/23/2019)

## Adaptive TAM

Main goal is to remap thrusters in such a way that we can control the sub using the drive/strafe/depth/pitch/roll/yaw axis in any orientation.  roll/pitch/yaw would always be in the world frame.  If the sub was rotated 90 degrees though the length of its body, you can imagine the yaw axis being remapped to the 4 down motors, and the depth remapped to the strafe motors.  This leaves a question of axis precidence.  For example how would we roll 90 degrees and then tilt the nose downward.  This would normal be the yaw axis, but its been remapped.  The pitch axis if correctly remaped would allow this downward tilt.  But then this would remap the roll axis and the setpoint would no longer correspond to the previous state.  Controlling the sub in this manner does not seem possible.

There are two ways we could remap the drive axis.  In either case it would always be in the plane orthogonal to the gravity vector as well as the XY plane of the sub body.  This leaves ambiguity when the sub is rolled 90 degrees as the planes are the same plane.

A different controller may be required.  Or we could focus on only meeting the goal of letting the sub be able to pitch enought to do its job.  Depending on the gripper pitch and roll into unusual orientations might be required to grasp objects and manipulate them as needed.  In this case relative body frame commands for control would make the mose sense, but how would we control these axis given our sensors?

To hold a given orientation and position there will need to be net zero forces and torques.  We need to therefore cancel out the buoyant force and torque without introducing new undesired torques/forces from the motors.  This can be computed from the known center of buoyancy, center of mass, and buoyant forces.  Using this model is should be possible to generate motor commands to hold any position, how to apply pid loops to maintain a given state though.  Rather than trying to mix body and world frame perhaps it makes the most sense to only contorl in one and map from the other.  We could control always in the world frame and then for body frame commands we could transform those into world frame.  This removes the issue of axis precidence as when we rotate to alighn ourselves with an obstacle those rotations can be in the body frame and done in sequence.  Or if we have a full pose solve we can generate and exact worldspace orientation as a goal.

How to move between orientations and deal with deviations?  If we have a TAM with worldspace mappings x/y/z/r/p/y we can control these though the sub dynamics model and the pid loops can be controling net forces along these axis.  The TAM is the dynamics model in this case.  For normal level operations we can map drive and strafe onto these axis.  But if we yawed at the same time we would end up with a different result.  We always have a worldspace yaw so maybe we can deal with drive and strafe in any orientation using that and stick with original control mappings.  World frame orientation still does not make much sense though in terms of rpy.  rpy suffers gimbal lock when pitched +/- 90 degrees.  Is it possible to do a pid loop on a quaternion.

This assumes accurate world space state estimation.  Without a DVL on Janus this will be difficult.  On leviathan we have the depth sensor for absolute Z, but when we are pitched our X-Axis from the DVL is not enough to maintain X-Axis State Estimation, we need the component from the DVL Z-Axis.  Some kind of USBL would be good for controls testing as we will not have to worry about the state estimation side for uSub.  Testing this code in the sim will be easy due to perfect state knowedge.

## LQR
LQR effectivly puts us in the realm of model predictive control.  We are taking the physics model for the submarine, linearizing it about a point, and then using LQR to generate control outputs.  This will also give us full 6 DoF control from a single controller.  Something that does not seem to be particularly possible from an pid controller, even attempting an Adaptive TAM.